---
kind: pipeline
type: docker
name: build-arm64

platform:
  os: linux
  arch: arm64

steps:
  - name: docker
    image: registry.slr.ovh/drone-docker
    volumes:
      - name: docker_sock
        path: /var/run/docker.sock
    settings:
      repo: registry.slr.ovh/rpi-node-puppeteer
      registry: registry.slr.ovh
      tags:
        - linux-arm64
      username:
        from_secret: registry_username
      password:
        from_secret: registry_password

volumes:
  - name: docker_sock
    host:
      path: /var/run/docker.sock

image_pull_secrets:
  - docker_config

---
kind: pipeline
type: docker
name: test-linux-arm64

platform:
  os: linux
  arch: arm64

clone:
  disable: true

steps:
  - name: Run test
    image: registry.slr.ovh/rpi-node-puppeteer:linux-arm64
    commands: 
      - node index.js

image_pull_secrets:
  - docker_config

depends_on:
  - build-arm64